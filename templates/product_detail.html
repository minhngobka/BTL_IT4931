<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ product.product_name }} - MyShop</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='product_detail.css') }}">
</head>
<body>
    <header class="main-header">
        <div class="top-bar">
            <div class="left-links">
                <a href="#">Kênh Người Bán</a>
                <a href="#">Trở thành Người bán</a>
                <a href="#">Tải ứng dụng</a>
                <a href="#">Kết nối</a>
            </div>
            <div class="right-links">
                <a href="#">Thông Báo</a>
                <a href="#">Hỗ Trợ</a>
                <a href="#">Tiếng Việt</a>
                <a href="#">Đăng Ký</a>
                <a href="#">Đăng Nhập</a>
            </div>
        </div>

        <div class="main-bar">
            <div class="logo"><a href="/">MyShop</a></div>
            <div class="search-bar">
                <input type="text" placeholder="Tìm sản phẩm...">
                <button>Tìm kiếm</button>
            </div>
            <div class="cart-icon">Giỏ hàng</div>
        </div>

        <!-- <nav class="quick-links">
            <a href="/">Quay lại</a>
            <a href="#">Áo Khoác</a>
            <a href="#">Giày Dép</a>
            <a href="#">Máy Tính</a>
            <a href="#">Điện Thoại</a>
            <a href="#">Mũ Nón</a>
            <a href="#">Phụ Kiện</a>
        </nav> -->
    </header>

    <div class="container">
        <div class="breadcrumb">
            <a href="/">Trang chủ</a> / 
            <a href="#">{{ product.category_name }}</a> / 
            <span>{{ product.product_name }}</span>
        </div>

        <main>
            <div class="product-detail-layout">
                <!-- Chi tiết sản phẩm (Cột trái) -->
                <section class="product-info-section">
                    <div class="detail-image-container">
                        <img src="{{ product.image_url }}" alt="{{ product.product_name }}" class="detail-image">
                        <!-- <div class="image-badge"></div> -->
                    </div>
                </section>

                <!-- Thông tin và mua hàng (Cột giữa) -->
                <section class="product-purchase-section">
                    <div class="product-meta">
                        <span class="product-category-badge">{{ product.category_name }}</span>
                        <span class="product-brand-badge">{{ product.brand }}</span>
                    </div>

                    <h1 class="product-title">{{ product.product_name }}</h1>

                    <div class="product-rating">
                        <!-- <div class="stars">⭐⭐⭐⭐⭐ (4.8)</div>
                        <span class="rating-count">2,451 đánh giá</span> -->
                    </div>

                    <div class="product-price-section">
                        <div class="price-display">
                            <span class="price">{{ "%.0f"|format(product.price|float) }}₫</span>
                            <span class="original-price">{{ "%.0f"|format(product.price|float * 1.2) }}₫</span>
                            <span class="discount">-17%</span>
                        </div>
                        <p class="price-note">Giá đã bao gồm VAT</p>
                    </div>

                    <div class="product-info-details">
                        <p><strong>Mã sản phẩm:</strong> {{ product.product_id }}</p>
                        <p><strong>Thương hiệu:</strong> {{ product.brand }}</p>
                        <p><strong>Danh mục:</strong> {{ product.category_name }}</p>
                        <p><strong>Tình trạng:</strong> <span class="in-stock">✓ Còn hàng</span></p>
                        <p><strong>Vận chuyển:</strong> Miễn phí toàn quốc</p>
                    </div>

                    <div class="product-actions">
                        <button class="btn-add-cart" onclick="addToCart()">Thêm vào giỏ</button>
                        <button class="btn-buy-now" onclick="buyNow()">Mua ngay</button>
                    </div>

                    <div class="product-benefits">
                        <div class="benefit">
                            <span class="benefit-icon">✓</span>
                            <span>Bảo hành 12 tháng</span>
                        </div>
                        <div class="benefit">
                            <span class="benefit-icon">✓</span>
                            <span>Trả hàng trong 30 ngày</span>
                        </div>
                        <div class="benefit">
                            <span class="benefit-icon">✓</span>
                            <span>Hỗ trợ 24/7</span>
                        </div>
                    </div>
                </section>

                <!-- Gợi ý sản phẩm (Cột phải) -->
                <section class="recommendations-section">
                    <h3>Sản Phẩm Liên Quan</h3>
                    <p class="recommendations-subtitle">Các sản phẩm khác bạn có thể thích</p>
                    <div id="recommendationsList" class="recommendations-grid">
                        <div class="loading">Đang tải gợi ý...</div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <footer class="footer">
        <p>&copy; 2025 MyShop - Sàn Thương Mại Điện Tử. All rights reserved.</p>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const productId = {{ product.product_id | tojson }};
            loadRecommendations(productId);
        });

        async function loadRecommendations(productId) {
            try {
                const response = await fetch('/api/recommend', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ product_id: productId })
                });

                const data = await response.json();
                displayRecommendations(data.recommendations);
            } catch (error) {
                console.error('Lỗi tải gợi ý:', error);
                document.getElementById('recommendationsList').innerHTML =
                    '<p class="error">Không thể tải gợi ý sản phẩm</p>';
            }
        }

        function displayRecommendations(recommendations) {
            const container = document.getElementById('recommendationsList');
            if (!recommendations || recommendations.length === 0) {
                container.innerHTML = '<p class="empty">Không có sản phẩm được gợi ý</p>';
                return;
            }

            container.innerHTML = recommendations.map(rec => `
                <div class="recommendation-card">
                    <img src="${rec.image_url || 'https://via.placeholder.com/200'}" alt="${rec.product_name}">
                    <div class="product-name">${rec.product_name}</div>
                    <div class="product-price">${(rec.price || 0).toLocaleString()}₫</div>
                    <button class="btn-view" onclick="viewProduct(${rec.product_id})">Xem chi tiết</button>
                </div>
            `).join('');
        }

        function viewProduct(productId) {
            window.location.href = `/product/${productId}`;
        }

        function addToCart() {
            alert('Thêm vào giỏ hàng thành công!');
        }
    </script>
</body>
</html>
